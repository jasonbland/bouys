<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Buoy Station Tracker</title>
  <link rel="stylesheet" href="client/styles/normalize.css">
  <link rel="stylesheet" href="client/styles/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script>
    // Changes XML to JSON
    function xmlToJson (xml) {
      // Create the return object
      var obj = {};

      if (xml.nodeType === 1) { // element
        // do attributes
        if (xml.attributes.length > 0) {
          obj['@attributes'] = {};
          for (var j = 0; j < xml.attributes.length; j++) {
            var attribute = xml.attributes.item(j);
            obj['@attributes'][attribute.nodeName] = attribute.nodeValue;
          }
        }
      } else if (xml.nodeType === 3) { // text
        obj = xml.nodeValue;
      }

      // do children
      if (xml.hasChildNodes()) {
        for (var i = 0; i < xml.childNodes.length; i++) {
          var item = xml.childNodes.item(i);
          var nodeName = item.nodeName;
          if (typeof (obj[nodeName]) === 'undefined') {
            obj[nodeName] = xmlToJson(item);
          } else {
            if (typeof (obj[nodeName].push) === 'undefined') {
              var old = obj[nodeName];
              obj[nodeName] = [];
              obj[nodeName].push(old);
            }
            obj[nodeName].push(xmlToJson(item));
          }
        }
      }
      return obj;
    }

    var buoys = [];

    $(document).ready(function () {
      // feed to parse
      var feed = 'http://www.ndbc.noaa.gov/rss/ndbc_obs_search.php?lat=40N&lon=73W&radius=100';

      $.ajax(feed, {
        accepts: {
          xml: 'application/rss+xml'
        },
        headers: {
          'Access-Control-Allow-Origin': '*'
        },
        dataType: 'xml',
        success: function (data) {
          $(data).find('item').each(function () { // or "item" or whatever suits your feed
            var el = $(this);

            var title = el.find('title').text();
            var pubDate = el.find('pubDate').text();
            var description = el.find('description').text().split('\n')
                              .reduce(function (results, elem) {
                                elem = elem.trim();
                                if (elem) {
                                  results.push(elem);
                                }
                                return results;

                              }, []);

            buoys.push({ title: title, pubDate: pubDate, description: description });
          });
          console.log(JSON.stringify(buoys, null, 4));
        }
      });
    });
</script>
</head>
<body>
  <div id="app"></div>
  <script src="client/compiled/bundle.js"></script>
</body>
</html>
